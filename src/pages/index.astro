---
// 1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Preparation Phase)

// -> ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ 'query' ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ String ‡πÉ‡∏ô RAM ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏≤
const query = `
	query GetSchoolSettings {
		generalSettings {
			title
			description
		}
	}
`;
// -> ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ URL (‡πÄ‡∏ä‡πà‡∏ô https://api.nongtao.ac.th/graphql) ‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
const url = import.meta.env.PUBLIC_WORDPRESS_API_URL;

let schoolData = null; // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏≠‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô null)
let errorMessage = null; // ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Error

try{
	// 2.fetch ‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô data ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô(wordpress subdomain)
	// HTTP Request Packet
	const response = await fetch(url,  {
		method: "POST",
		headers: {
			"Content-Type": "application/json",
		},
		body: JSON.stringify({query})
		// ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß body ‡∏à‡∏≤‡∏Å JS > JSON 
	});
	// -> Browser/Node.js ‡∏™‡∏£‡πâ‡∏≤‡∏á HTTP Request ‡∏ß‡∏¥‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô DNS -> IP Address -> Server
	// -> WordPress Server ‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á -> ‡∏£‡∏±‡∏ô PHP -> Query MySQL -> ‡∏™‡∏£‡πâ‡∏≤‡∏á JSON ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö

	// 3. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡∏±‡∏ï‡∏£‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏≤‡∏á (HTTP Status)
  	// response.ok ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô true ‡∏ñ‡πâ‡∏≤ status ‡∏Ñ‡∏∑‡∏≠ 200-299	
	if(!response.ok){
		throw new Error(`Server ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥: ${response.status}`);
		// ‡∏Å‡∏≤‡∏£ throw ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà catch ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
	}
	
	// 4. ‡∏™‡∏±‡πà‡∏á‡∏≠‡πà‡∏≤‡∏ô Stream ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏ô‡∏à‡∏ö (Download Body)
	const json = await response.json();
	// -> Parse String ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô JSON ‡πÄ‡∏õ‡πá‡∏ô JavaScript Object ( { data: ... } )

	// 5. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ WordPress ‡∏î‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÑ‡∏´‡∏°? (GraphQL Errors)
  	// ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏™‡πà‡∏á 200 OK ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ "Query ‡∏ú‡∏¥‡∏î‡∏ô‡∏∞"
  	if (json.errors) {
    throw new Error(`GraphQL ‡∏ü‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤: ${json.errors[0].message}`);
  	}
	// 6. ‡∏´‡∏¢‡∏¥‡∏ö‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ß‡∏≤‡∏á (‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô)
	// ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏∑‡∏≠: json -> data -> generalSettings
	schoolData = json.data.generalSettings;
	} catch (error) {
	// 7. ‡πÇ‡∏ã‡∏ô‡∏£‡∏±‡∏ö‡∏à‡∏ö (‡∏ñ‡πâ‡∏≤‡∏û‡∏±‡∏á‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô‡∏Å‡πá‡∏ï‡∏≤‡∏° ‡∏à‡∏∞‡∏°‡∏≤‡∏ï‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)
	console.error("üí• ‡∏û‡∏±‡∏á‡∏¢‡∏±‡∏ö‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå:", error);
    errorMessage = "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ";
	}
---


